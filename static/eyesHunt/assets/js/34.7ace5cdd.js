(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{317:function(t,e,v){"use strict";v.r(e);var n=v(10),_=Object(n.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("p",[t._v("扫码登录功能主要分为三个阶段："),e("strong",[t._v("待扫描、已扫描待确认、已确认")]),t._v("。")]),t._v(" "),e("p",[t._v("整体流程图如图:\n"),e("img",{attrs:{src:"http://hunt-cdn.eyescode.top/content/33ffe8f30ab82cc2831631e112e6b796.png",alt:"扫码登录流程图"}})]),t._v(" "),e("p",[t._v("下面分阶段来看看设计原理。")]),t._v(" "),e("h1",{attrs:{id:"一-待扫描阶段"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一-待扫描阶段"}},[t._v("#")]),t._v(" 一：待扫描阶段")]),t._v(" "),e("p",[t._v("首先是待扫描阶段，这个阶段是 PC 端跟服务端的交互过程。")]),t._v(" "),e("p",[t._v("每次用户打开PC端登陆请求，系统返回一个唯一的二维码ID，并将二维码ID的信息绘制成二维码返回给用户。这里的二维码ID一定是唯一的，后续流程会将二维码ID跟身份信息绑定，不唯一的话就会造成你登录了其他用户的账号或者其他用户登录你的账号。")]),t._v(" "),e("p",[t._v("此时在 PC 端会启动一个定时器，轮询查询二维码是否被扫描。如果移动端未扫描的话，那么一段时间后二维码将会失效。")]),t._v(" "),e("h1",{attrs:{id:"二-已扫描待确认阶段"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二-已扫描待确认阶段"}},[t._v("#")]),t._v(" 二：已扫描待确认阶段")]),t._v(" "),e("p",[t._v("第二个阶段是已扫描待确认阶段，主要是移动端跟服务端交互的过程。")]),t._v(" "),e("p",[t._v("首先移动端扫描二维码，获取二维码ID，然后将手机端登录的凭证（token）和二维码ID作为参数发送给服务端。此时的手机在之前已经是登录的，不存在没登录的情况。服务端接受请求后，会将 token 与二维码ID关联，然后会生成一个临时token，这个 token 会返回给移动端，临时 token 用作确认登录的凭证。PC 端的定时器，会轮询到二维码的状态已经发生变化，然后将 PC 端的二维码更新为已扫描，请在手机端确认。")]),t._v(" "),e("p",[t._v("这里为什么要有手机端确认的操作？假设没有确认这个环节，很容易就会被坏人拦截 token 去冒充登录。所以二维码扫描一定要有这个确认的页面，让用户去确认是否进行登录。另外，二维码扫描确认之后，再往用户app或手机等发送登录提醒的通知，告知如果不是本人登录的，则建议用户立即修改密码。")]),t._v(" "),e("h1",{attrs:{id:"三-已确认"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#三-已确认"}},[t._v("#")]),t._v(" 三：已确认")]),t._v(" "),e("p",[t._v("扫码登录的最后阶段，用户点击确认登录，移动端携带上一步骤中获取的临时 token 访问服务端。服务端校对完成后，会更新二维码状态，并且给 PC 端生成一个正式的 token。后续 PC 端就是持有这个 token 访问服务端。")]),t._v(" "),e("hr"),t._v(" "),e("p",[t._v("原作者：大彬")]),t._v(" "),e("p",[t._v("原文链接：https://www.topjavaer.cn/advance/system-design/1-scan-code-login.html")]),t._v(" "),e("p",[t._v("站长略有修改")])])}),[],!1,null,null,null);e.default=_.exports}}]);