import{E as B}from"./el-button-BiYwfNb7.js";import{E as Q}from"./el-pagination-_FHyq6Tc.js";import{E as W}from"./el-input-D9jqeYXg.js";import{E as L,a as M}from"./el-select-DZX1Ptzy.js";import"./el-popper-XxQwgVmP.js";import{E as X,a as Y}from"./el-table-column-M44UI9A7.js";import"./el-tooltip-l0sNRNKZ.js";import{E as Z}from"./el-popover-CUqzKF0H.js";import{d as z,K as j,o as A,a as p,c as I,f as t,w as l,U as S,aa as $,n as U,h as D,i as w,j as k,E as i,at as R,au as F,b as V,ax as K,r as _,L as ee,t as ae,ay as q}from"./index-NHIm5-uZ.js";import{_ as G}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{E as oe}from"./el-overlay-CHWBwd7q.js";import"./index-C1H9JqF_.js";import"./vnode-Ch83emUg.js";const te=r=>(R("data-v-1f1f4ab2"),r=r(),F(),r),se={class:"condition"},le=te(()=>V("span",{class:"label"},"应用名",-1)),ne=z({__name:"condition",emits:["search"],setup(r,{emit:C}){const N=C,b=j([]),c=j({appId:""});function h(){w.getAppDictionary().then(({code:u,msg:f,data:y})=>{if(u!=k.success){i({type:"error",message:"应用信息获取失败："+f});return}y.forEach((E,s)=>{b[s]={label:E.label,value:E.value}})})}function d(){N("search",c)}return A(()=>{h()}),(u,f)=>{const y=L,E=M,s=B;return p(),I("div",se,[le,t(E,{class:"appName",modelValue:c.appId,"onUpdate:modelValue":f[0]||(f[0]=e=>c.appId=e),filterable:"",clearable:""},{default:l(()=>[(p(!0),I(S,null,$(b,e=>(p(),U(y,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t(s,{class:"search",plain:"",onClick:d},{default:l(()=>[D("查询")]),_:1})])}}}),re=G(ne,[["__scopeId","data-v-1f1f4ab2"]]),ce=r=>(R("data-v-f013b56c"),r=r(),F(),r),ue={class:"edit"},pe={class:"inputGroup"},ie=ce(()=>V("span",{class:"label"},"应用名",-1)),de={class:"inputGroup"},me={class:"label"},_e={class:"dialog-footer"},fe=z({__name:"edit",props:{show:Number,data:Object},emits:["reload"],setup(r,{emit:C}){const N=C,b=K(),c=r,h=_(""),d=_(!1),u=_([]);ee(()=>c.show,s=>{h.value=c.data.appName,u.value!=null&&u.value.forEach(e=>{e.model=c.data[e.value+"Code"]}),d.value=!0});function f(){w.getProcessorDictionary().then(({code:s,msg:e,data:v})=>{if(s!=k.success){i({type:"error",message:"处理器字典获取失败："+e});return}Promise.all(v.map(P=>y(P.value))).then(P=>{P.forEach((g,o)=>{if(g.code!=k.success){i({type:"error",message:`获取类别为${g.value}的处理器失败：`+g.msg});return}let m=g.data;u.value.push({label:v[o].label,value:v[o].value,instansts:m,model:[]})})})})}async function y(s){return await w.getProcessorByGenre([s])}function E(){if(!b.checkAuth(q.admin)){i({type:"error",message:"权限不足！"});return}let s={appId:c.data.appId};u.value.forEach(e=>{s[e.value]=e.model||[]}),w.saveAppProcessor(s).then(({code:e,msg:v})=>{if(e!=k.success){i({type:"error",message:"更新应用处理器失败："+v});return}i({type:"success",message:"更新应用处理器成功"}),d.value=!1,N("reload")})}return A(()=>{f()}),(s,e)=>{const v=W,P=L,g=M,o=B,m=oe;return p(),I("div",ue,[t(m,{class:"save",modelValue:d.value,"onUpdate:modelValue":e[2]||(e[2]=a=>d.value=a),title:"编辑应用插件",width:"480"},{footer:l(()=>[V("div",_e,[t(o,{onClick:e[1]||(e[1]=a=>d.value=!1)},{default:l(()=>[D("取消")]),_:1}),t(o,{type:"primary",onClick:E},{default:l(()=>[D("保存")]),_:1})])]),default:l(()=>[V("div",null,[V("div",pe,[ie,t(v,{class:"input",modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=a=>h.value=a),disabled:""},null,8,["modelValue"])]),(p(!0),I(S,null,$(u.value,a=>(p(),I("div",de,[V("span",me,ae(a.label),1),t(g,{class:"input",modelValue:a.model,"onUpdate:modelValue":n=>a.model=n,multiple:"",clearable:""},{default:l(()=>[(p(!0),I(S,null,$(a.instansts,n=>(p(),U(P,{key:n.value,label:n.label,value:n.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]))),256))])]),_:1},8,["modelValue"])])}}}),ve=G(fe,[["__scopeId","data-v-f013b56c"]]),ge={class:"manage"},be={class:"data"},he="prev, pager, next",ye=z({__name:"index",setup(r){let C={appId:""};const N=K(),b=_(1),c=_(10),h=_(0),d=_([]),u=_([{prop:"appName",label:"应用名"}]),f=_(0),y=_();function E(){w.getProcessorDictionary().then(({code:o,msg:m,data:a})=>{if(o!=k.success){i({type:"error",message:"处理器字典获取失败："+m});return}a.forEach(n=>{u.value.push({prop:n.value,label:n.label})})})}function s(){w.getProcessorByPage({appId:C.appId?Number(C.appId):null,pageNo:b.value,pageSize:c.value}).then(({code:o,msg:m,data:a})=>{if(o!=k.success){i({type:"error",message:"应用插件列表获取失败："+m});return}h.value=a.total,d.value=a.data})}function e(o){C.appId=o.appId,s()}function v(o){b.value=o,s()}function P(o){y.value=o.row,f.value++}function g(o){if(!N.checkAuth(q.admin)){i({type:"error",message:"权限不足"});return}w.refreshProcessor([o.row.appId]).then(({code:m,msg:a})=>{if(m!=k.success){i({type:"error",message:"处理器容器刷新失败："+a});return}i({type:"success",message:"处理器容器刷新成功"})})}return A(()=>{s(),E()}),(o,m)=>{const a=Y,n=B,O=Z,H=X,J=Q;return p(),I("div",ge,[t(re,{onSearch:e}),V("div",be,[t(H,{class:"table",border:!0,data:d.value},{default:l(()=>[t(a,{type:"index",align:"center"}),(p(!0),I(S,null,$(u.value,x=>(p(),U(a,{prop:x.prop,label:x.label,align:"center"},null,8,["prop","label"]))),256)),t(a,{prop:"content",label:"操作",align:"center"},{default:l(x=>[t(n,{size:"small",onClick:T=>P(x)},{default:l(()=>[D("编辑")]),_:2},1032,["onClick"]),t(O,{title:"确认删除吗?",onConfirm:T=>g(x)},{reference:l(()=>[t(n,{size:"small"},{default:l(()=>[D("删除")]),_:1})]),_:2},1032,["onConfirm"]),t(O,{title:"确认刷新容器吗?",onConfirm:T=>g(x)},{reference:l(()=>[t(n,{size:"small"},{default:l(()=>[D("刷新容器")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"]),t(J,{class:"pagination","current-page":b.value,"page-size":c.value,total:h.value,layout:he,onCurrentChange:v},null,8,["current-page","page-size","total"])]),t(ve,{show:f.value,data:y.value,onReload:s},null,8,["show","data"])])}}}),ze=G(ye,[["__scopeId","data-v-93f196b1"]]);export{ze as default};
