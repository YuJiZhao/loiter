import{E as J}from"./el-button-C0k8b0Uu.js";import{E as ee}from"./el-pagination-D1tgt_kk.js";import{E as ae}from"./el-input-Bl7HZI7a.js";import{E as q,a as H}from"./el-select-B6CuLMMT.js";import"./el-popper-BcKKSjAX.js";import{E as le,a as te}from"./el-table-column-BFe8cHpw.js";import"./el-tooltip-l0sNRNKZ.js";import{E as oe}from"./el-popover-BhCcHf01.js";import{d as R,K as N,o as F,a as _,c as S,f as t,w as u,U as A,aa as U,n as $,h as O,i as D,j as k,E as b,at as Q,au as W,b as p,ax as X,r as E,L as ne,e as j,aC as B,ay as Y,aB as se}from"./index-PF-Fl51z.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{E as re}from"./el-overlay-HUXVHpxd.js";import"./flatten-D1jLvMYC.js";import"./index-_QU7_dNm.js";import"./vnode-D19UwqZF.js";const Z=g=>(Q("data-v-a9b78d49"),g=g(),W(),g),ie={class:"condition"},ue=Z(()=>p("span",{class:"label"},"应用",-1)),pe=Z(()=>p("span",{class:"label"},"限流器",-1)),ce=R({__name:"condition",emits:["search"],setup(g,{emit:V}){const z=V,n=N([]),w=N([]),c=N({appId:"",limiter:""});function a(){D.getAppDictionary().then(({code:d,msg:r,data:h})=>{if(d!=k.success){b({type:"error",message:"应用信息获取失败："+r});return}h.forEach((m,I)=>{n[I]={label:m.label,value:m.value}})})}function C(){D.getLimiterDictionary().then(({code:d,msg:r,data:h})=>{if(d!=k.success){b({type:"error",message:"限流器信息获取失败："+r});return}h.forEach((m,I)=>{w[I]={label:m.label,value:m.value}})})}function x(){z("search",c)}return F(()=>{a(),C()}),(d,r)=>{const h=q,m=H,I=J;return _(),S("div",ie,[ue,t(m,{class:"select",modelValue:c.appId,"onUpdate:modelValue":r[0]||(r[0]=s=>c.appId=s),filterable:"",clearable:""},{default:u(()=>[(_(!0),S(A,null,U(n,s=>(_(),$(h,{key:s.value,label:s.label,value:s.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),pe,t(m,{class:"select",modelValue:c.limiter,"onUpdate:modelValue":r[1]||(r[1]=s=>c.limiter=s),filterable:"",clearable:""},{default:u(()=>[(_(!0),S(A,null,U(w,s=>(_(),$(h,{key:s.value,label:s.label,value:s.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t(I,{class:"search",plain:"",onClick:x},{default:u(()=>[O("查询")]),_:1})])}}}),de=K(ce,[["__scopeId","data-v-a9b78d49"]]),G=g=>(Q("data-v-a1b33082"),g=g(),W(),g),me={class:"inputGroup"},_e=G(()=>p("span",{class:"label"},"应用名",-1)),fe={class:"inputGroup"},ve=G(()=>p("span",{class:"label"},"限流器",-1)),be={class:"inputGroup"},ge=G(()=>p("span",{class:"label"},"限流模式",-1)),he={class:"inputGroup"},ye=G(()=>p("span",{class:"label"},"参数示例",-1)),Ve={class:"inputGroup"},Ie=G(()=>p("span",{class:"label"},"限流参数",-1)),Ee={class:"dialog-footer"},Ce=R({__name:"save",props:{show:Number,flag:Number,data:Object},emits:["reload"],setup(g,{emit:V}){const z=V,n=g,w=X(),c=E(!1),a=N({appId:"",limiter:"",mode:"",parameter:""}),C=E(""),x=N([]),d=N([]),r=N([]);ne(()=>n.show,o=>{T(),n.flag==B.update&&f(),c.value=!0});function h(){D.getAppDictionary().then(({code:o,msg:e,data:v})=>{if(o!=k.success){b({type:"error",message:"应用信息获取失败："+e});return}v.forEach((i,y)=>{x[y]={label:i.label,value:i.value}})})}function m(){D.getLimiterDictionary().then(({code:o,msg:e,data:v})=>{if(o!=k.success){b({type:"error",message:"限流器信息获取失败："+e});return}v.forEach((i,y)=>{d[y]={label:i.label,value:i.value,appendix:i.appendix}})})}function I(){D.getLimiterModeDictionary().then(({code:o,msg:e,data:v})=>{if(o!=k.success){b({type:"error",message:"限流器模式信息获取失败："+e});return}v.forEach((i,y)=>{r[y]={label:i.label,value:i.value}})})}function s(o){for(let e in d)if(d[e].value==o){C.value=d[e].appendix||"";return}}function P(){if(a.parameter)try{JSON.parse(a.parameter)}catch{b({type:"error",message:"参数不为JSON格式！"});return}if(!w.checkAuth(Y.admin)){b({type:"error",message:"权限不足！"});return}D.saveAppLimiter({...a,appId:a.appId?Number(a.appId):null}).then(({code:o,msg:e})=>{if(o!=k.success){b({type:"error",message:"保存失败："+e});return}c.value=!1,z("reload")})}function T(){a.appId="",a.limiter="",a.mode="",a.parameter="",C.value=""}function f(){a.appId=String(n.data.appId),a.limiter=n.data.limiterCode,a.mode=n.data.mode,a.parameter=n.data.parameter,s(n.data.limiterCode)}return F(()=>{h(),m(),I()}),(o,e)=>{const v=q,i=H,y=ae,M=J,L=re;return _(),$(L,{class:"save",modelValue:c.value,"onUpdate:modelValue":e[6]||(e[6]=l=>c.value=l),title:n.flag==j(B).add?"新增应用限流器":"编辑应用限流器",width:"500"},{footer:u(()=>[p("div",Ee,[t(M,{onClick:e[5]||(e[5]=l=>c.value=!1)},{default:u(()=>[O("取消")]),_:1}),t(M,{type:"primary",onClick:P},{default:u(()=>[O("保存")]),_:1})])]),default:u(()=>[p("div",null,[p("div",me,[_e,t(i,{class:"input",modelValue:a.appId,"onUpdate:modelValue":e[0]||(e[0]=l=>a.appId=l),disabled:n.flag!=j(B).add,filterable:"",clearable:""},{default:u(()=>[(_(!0),S(A,null,U(x,l=>(_(),$(v,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),p("div",fe,[ve,t(i,{class:"input",modelValue:a.limiter,"onUpdate:modelValue":e[1]||(e[1]=l=>a.limiter=l),clearable:"",onChange:s},{default:u(()=>[(_(!0),S(A,null,U(d,l=>(_(),$(v,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),p("div",be,[ge,t(i,{class:"input",modelValue:a.mode,"onUpdate:modelValue":e[2]||(e[2]=l=>a.mode=l),clearable:""},{default:u(()=>[(_(!0),S(A,null,U(r,l=>(_(),$(v,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),p("div",he,[ye,t(y,{class:"input",modelValue:C.value,"onUpdate:modelValue":e[3]||(e[3]=l=>C.value=l),type:"textarea",autosize:"",disabled:""},null,8,["modelValue"])]),p("div",Ve,[Ie,t(y,{class:"input",modelValue:a.parameter,"onUpdate:modelValue":e[4]||(e[4]=l=>a.parameter=l),type:"textarea",autosize:""},null,8,["modelValue"])])])]),_:1},8,["modelValue","title"])}}}),xe=K(Ce,[["__scopeId","data-v-a1b33082"]]),De={class:"limiter"},ke={class:"data"},Se="prev, pager, next",we=R({__name:"index",setup(g){let V={appId:"",limit:""};const z=X(),n=E(1),w=E(10),c=E(0),a=E([]),C=[{prop:"appName",label:"应用名"},{prop:"limiterName",label:"限流器"},{prop:"mode",label:"方式"},{prop:"parameter",label:"参数配置"},{prop:"updatedAt",label:"更新时间"}],x=E(0),d=E(),r=E();function h(f){V.appId=f.appId,V.limit=f.limit,m()}function m(){D.getLimiterByPage({appId:V.appId?Number(V.appId):null,limit:V.limit,pageNo:n.value,pageSize:w.value}).then(({code:f,msg:o,data:e})=>{if(f!=k.success){b({type:"error",message:"应用限流器信息获取失败："+o});return}c.value=e.total,a.value=e.data})}function I(f){n.value=f}function s(){d.value=B.add,r.value=null,x.value++}function P(f){d.value=B.update,r.value=f.row,x.value++}function T(f){if(!z.checkAuth(Y.admin)){b({type:"error",message:"权限不足"});return}D.refreshLimiter([f.row.appId]).then(({code:o,msg:e})=>{if(o!=k.success){b({type:"error",message:"限流器容器刷新失败："+e});return}b({type:"success",message:"限流器容器刷新成功"})})}return F(()=>{m()}),(f,o)=>{const e=te,v=J,i=oe,y=le,M=ee;return _(),S("div",De,[t(de,{onSearch:h}),p("div",ke,[t(y,{class:"table",border:!0,data:a.value},{default:u(()=>[t(e,{type:"index",align:"center"}),(_(),S(A,null,U(C,L=>t(e,{prop:L.prop,label:L.label,align:"center"},null,8,["prop","label"])),64)),t(e,{prop:"content",label:"操作",align:"center"},{default:u(L=>[t(v,{size:"small",onClick:l=>P(L)},{default:u(()=>[O("编辑")]),_:2},1032,["onClick"]),t(i,{title:"确认刷新容器吗?",onConfirm:l=>T(L)},{reference:u(()=>[t(v,{size:"small"},{default:u(()=>[O("刷新容器")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"]),t(M,{class:"pagination","current-page":n.value,"page-size":w.value,total:c.value,layout:Se,onCurrentChange:I},null,8,["current-page","page-size","total"])]),t(v,{class:"saveBtn",icon:j(se),type:"primary",circle:"",size:"large",onClick:s},null,8,["icon"]),t(xe,{show:x.value,flag:d.value,data:r.value,onReload:m},null,8,["show","flag","data"])])}}}),Re=K(we,[["__scopeId","data-v-59d3c06a"]]);export{Re as default};
