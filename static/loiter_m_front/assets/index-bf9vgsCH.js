import{E as A}from"./el-button-BiYwfNb7.js";import{E as W}from"./el-pagination-_FHyq6Tc.js";import{E as X}from"./el-input-D9jqeYXg.js";import{E as T,a as j}from"./el-select-DZX1Ptzy.js";import"./el-popper-XxQwgVmP.js";import{E as Y,a as Z}from"./el-table-column-M44UI9A7.js";import"./el-tooltip-l0sNRNKZ.js";import{E as ee}from"./el-popover-CUqzKF0H.js";import{d as z,K as x,o as U,a as d,c as E,f as t,w as c,U as D,aa as S,n as $,h as N,i as B,j as C,E as b,at as G,au as L,b as f,ax as M,r as h,L as ae,ay as R}from"./index-NHIm5-uZ.js";import{_ as O}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{E as te}from"./el-overlay-CHWBwd7q.js";import"./index-C1H9JqF_.js";import"./vnode-Ch83emUg.js";const F=p=>(G("data-v-25a571ec"),p=p(),L(),p),le={class:"condition"},oe=F(()=>f("span",{class:"label"},"应用",-1)),ne=F(()=>f("span",{class:"label"},"负载策略",-1)),se=z({__name:"condition",emits:["search"],setup(p,{emit:_}){const k=_,v=x([]),u=x([]),n=x({appId:"",balancer:""});function y(){B.getAppDictionary().then(({code:m,msg:o,data:e})=>{if(m!=C.success){b({type:"error",message:"应用信息获取失败："+o});return}e.forEach((r,i)=>{v[i]={label:r.label,value:r.value}})})}function g(){B.getBalancerDictionary().then(({code:m,msg:o,data:e})=>{if(m!=C.success){b({type:"error",message:"负载均衡策略获取失败："+o});return}e.forEach((r,i)=>{u[i]=r})})}function V(){k("search",n)}return U(()=>{y(),g()}),(m,o)=>{const e=T,r=j,i=A;return d(),E("div",le,[oe,t(r,{class:"appName",modelValue:n.appId,"onUpdate:modelValue":o[0]||(o[0]=l=>n.appId=l),filterable:"",clearable:""},{default:c(()=>[(d(!0),E(D,null,S(v,l=>(d(),$(e,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),ne,t(r,{class:"status",modelValue:n.balancer,"onUpdate:modelValue":o[1]||(o[1]=l=>n.balancer=l),clearable:""},{default:c(()=>[(d(!0),E(D,null,S(u,l=>(d(),$(e,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t(i,{class:"search",plain:"",onClick:V},{default:c(()=>[N("查询")]),_:1})])}}}),re=O(se,[["__scopeId","data-v-25a571ec"]]),K=p=>(G("data-v-a1776baa"),p=p(),L(),p),ce={class:"edit"},pe={class:"inputGroup"},ue=K(()=>f("span",{class:"label"},"应用名",-1)),ie={class:"inputGroup"},de=K(()=>f("span",{class:"label"},"负载均衡",-1)),_e={class:"dialog-footer"},me=z({__name:"edit",props:{show:Number,data:Object},emits:["reload"],setup(p,{emit:_}){const k=_,v=M(),u=p,n=h(!1),y=x([]),g=h();ae(()=>u.show,o=>{g.value=u.data.balancerCode,n.value=!0});function V(){B.getBalancerDictionary().then(({code:o,msg:e,data:r})=>{if(o!=C.success){b({type:"error",message:"负载均衡策略获取失败："+e});return}r.forEach((i,l)=>{y[l]=i})})}function m(){if(!v.checkAuth(R.admin)){b({type:"error",message:"权限不足！"});return}B.updateAppBalancer({appId:u.data.id,balancer:g.value}).then(({code:o,msg:e})=>{if(o!=C.success){b({type:"error",message:"应用负载均衡策略更新失败："+e});return}n.value=!1,k("reload")})}return U(()=>{V()}),(o,e)=>{const r=X,i=T,l=j,s=A,I=te;return d(),E("div",ce,[t(I,{class:"save",modelValue:n.value,"onUpdate:modelValue":e[3]||(e[3]=a=>n.value=a),title:"编辑负载均衡策略",width:"400"},{footer:c(()=>[f("div",_e,[t(s,{onClick:e[2]||(e[2]=a=>n.value=!1)},{default:c(()=>[N("取消")]),_:1}),t(s,{type:"primary",onClick:m},{default:c(()=>[N("保存")]),_:1})])]),default:c(()=>[f("div",null,[f("div",pe,[ue,t(r,{class:"input",modelValue:u.data.appName,"onUpdate:modelValue":e[0]||(e[0]=a=>u.data.appName=a),disabled:""},null,8,["modelValue"])]),f("div",ie,[de,t(l,{class:"input",modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=a=>g.value=a),clearable:""},{default:c(()=>[(d(!0),E(D,null,S(y,a=>(d(),$(i,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])])]),_:1},8,["modelValue"])])}}}),be=O(me,[["__scopeId","data-v-a1776baa"]]),fe={class:"balancer"},ve={class:"data"},ge="prev, pager, next",he=z({__name:"index",setup(p){let _={appId:"",balancer:""};const k=M(),v=h(1),u=h(10),n=h(0),y=h([]),g=[{prop:"appName",label:"应用名"},{prop:"balancerName",label:"负载均衡策略"},{prop:"operator",label:"操作人"},{prop:"updatedAt",label:"操作时间"}],V=h(0),m=h({});function o(s){_.appId=s.appId,_.balancer=s.balancer,e()}function e(){B.getBalancerByPage({appId:_.appId?Number(_.appId):null,balancer:_.balancer,pageNo:v.value,pageSize:u.value}).then(({code:s,msg:I,data:a})=>{if(s!=C.success){b({type:"error",message:"应用负载均衡策略获取失败："+I});return}n.value=a.total,y.value=a.data})}function r(s){v.value=s,e()}function i(s){m.value=s.row,V.value++}function l(s){if(!k.checkAuth(R.admin)){b({type:"error",message:"权限不足"});return}B.refreshBalancer([s.row.id]).then(({code:I,msg:a})=>{if(I!=C.success){b({type:"error",message:"应用负载均衡容器刷新失败："+a});return}b({type:"success",message:"应用负载均衡容器刷新成功"})})}return U(()=>{e()}),(s,I)=>{const a=Z,P=A,q=ee,H=Y,J=W;return d(),E("div",fe,[t(re,{onSearch:o}),f("div",ve,[t(H,{class:"table",border:!0,data:y.value},{default:c(()=>[t(a,{type:"index",align:"center"}),(d(),E(D,null,S(g,w=>t(a,{prop:w.prop,label:w.label,align:"center"},null,8,["prop","label"])),64)),t(a,{label:"操作",align:"center"},{default:c(w=>[t(P,{size:"small",onClick:Q=>i(w)},{default:c(()=>[N("编辑")]),_:2},1032,["onClick"]),t(q,{title:"确认刷新容器吗?",onConfirm:Q=>l(w)},{reference:c(()=>[t(P,{size:"small"},{default:c(()=>[N("刷新容器")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"]),t(J,{class:"pagination","current-page":v.value,"page-size":u.value,total:n.value,layout:ge,onCurrentChange:r},null,8,["current-page","page-size","total"])]),t(be,{data:m.value,show:V.value,onReload:e},null,8,["data","show"])])}}}),Ae=O(he,[["__scopeId","data-v-0b9ab104"]]);export{Ae as default};
